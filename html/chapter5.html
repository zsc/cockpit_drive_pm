<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>Chapter 5｜对话上下文导航升级方案（从对话到路线到执行）</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>目录</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="搜索..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">驾舱一体（自动驾驶 × 智能车舱）整体设计与项目流程文档</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 1｜项目概览与北极星目标 (Project Overview & North Star Goals)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 2｜用户体验蓝图与核心场景 (User Experience Blueprint & Core Scenarios)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 3｜需求体系与范围管理 (Requirements & Scope)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 4｜驾舱一体目标架构总览</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 5｜对话上下文导航升级方案（从对话到路线到执行）</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 6｜座舱大模型升级方案（多域融合且稳定可控）</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 7｜驾舱一体的“统一代理”与共享状态设计</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 8｜数据、训练与评测闭环（从日志到迭代）</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 9｜安全、合规与可控性体系</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 10｜平台工程与端云协同（部署、成本、可观测）</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 11｜测试策略、验收标准与交付物</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 12｜组织阵型与协作机制（面向交付）</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 13｜项目计划与时间控制节点（Gates）</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 14｜风险清单与应对预案 (Risk Management & Contingency)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter15.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Chapter 11｜测试策略、验收标准与交付物</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="chapter-5">Chapter 5｜对话上下文导航升级方案（从对话到路线到执行）</h1>
<h2 id="1">1. 开篇段落</h2>
<p><strong>本章目标</strong>：
本章旨在重新定义“导航”在驾舱一体中的形态。我们将从“用户作为操作工（指令输入）”转变为“用户作为指挥官（意图表达）”。对于产品经理和架构师而言，核心挑战在于搭建一座桥梁，连接<strong>概率性的 LLM（大语言模型）</strong>与<strong>确定性的 AD（自动驾驶系统）</strong>。</p>
<p><strong>关键差异</strong>：
在传统 App 导航中，用户自行承担了“选择地点、确认路线、点击开始”的责任，AD 系统仅负责执行。而在对话式导航中，系统不仅要理解“去哪”，还要替用户完成“规划与决策”，最后由 AD 执行。因此，本章将重点阐述<strong>上下文理解的深度</strong>、<strong>意图转化为参数的精度</strong>以及<strong>确认机制（Confirmation Protocol）的严密度</strong>。</p>
<hr />
<h2 id="2">2. 文字论述</h2>
<h3 id="51-vision-action-intent-confirmation-action">5.1 链路重构：从 Vision -&gt; Action 到 Intent -&gt; Confirmation -&gt; Action</h3>
<p>现有的端到端（E2E）自驾方案通常以“已确定的导航路径”为输入。本期升级将在其上游构建一个复杂的决策漏斗。</p>
<h4 id="511">5.1.1 现状与目标对比</h4>
<p>| 维度 | 现状（App/触控链路） | 目标（对话上下文链路） |</p>
<table>
<thead>
<tr>
<th style="text-align: left;">维度</th>
<th style="text-align: left;">现状（App/触控链路）</th>
<th style="text-align: left;">目标（对话上下文链路）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>输入源</strong></td>
<td style="text-align: left;">结构化地址/坐标 (POI ID)</td>
<td style="text-align: left;">非结构化语音流 (Audio Stream)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>交互轮次</strong></td>
<td style="text-align: left;">单次（点击即走）</td>
<td style="text-align: left;">多轮（澄清、修改、确认）</td>
</tr>
<tr>
<td style="text-align: left;"><strong>上下文</strong></td>
<td style="text-align: left;">无（每次导航独立）</td>
<td style="text-align: left;">强相关（记忆“我家”、“刚才那个店”）</td>
</tr>
<tr>
<td style="text-align: left;"><strong>容错机制</strong></td>
<td style="text-align: left;">用户自己选错自己负责</td>
<td style="text-align: left;">系统需提供纠错、反问与确认机制</td>
</tr>
<tr>
<td style="text-align: left;"><strong>核心风险</strong></td>
<td style="text-align: left;">地图数据偏差</td>
<td style="text-align: left;"><strong>语义理解偏差 (Hallucination)</strong></td>
</tr>
</tbody>
</table>
<h4 id="512">5.1.2 目标数据流全景图</h4>
<div class="codehilite"><pre><span></span><code><span class="k">[ 用户 User ]</span>
<span class="w">      </span><span class="na">|</span>
<span class="w">      </span><span class="na">v (语音</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;先接老婆，再去公司，避开施工&quot;)</span>
<span class="k">[ 1. 听觉感知层 (ASR + VAD) ]</span>
<span class="w">      </span><span class="na">| (文本流)</span>
<span class="w">      </span><span class="na">v</span>
<span class="k">[ 2. 认知规划层 (Trip Agent - LLM) ] &lt;==&gt; [ 记忆模块 (Session/User Profile) ]</span>
<span class="w">      </span><span class="na">| (意图</span><span class="o">:</span><span class="w"> </span><span class="s">Nav, 约束: Avoid_Workzone, 途经: Wife_Loc)</span>
<span class="w">      </span><span class="na">v</span>
<span class="k">[ 3. 地图服务层 (Map Service) ]</span>
<span class="w">      </span><span class="na">| --&gt; POI Disambiguation (地点消歧</span><span class="o">:</span><span class="w"> </span><span class="s">哪个公司? 哪个位置接人?)</span>
<span class="w">      </span><span class="na">| --&gt; Route Planning (多策略算路)</span>
<span class="w">      </span><span class="na">v</span>
<span class="na">[ 4. 交互仲裁层 (Confirmation Manager) ] &lt;--(关键!) 安全阀门</span>
<span class="w">      </span><span class="na">| (输出</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;已规划经停A去B的路线，比平时慢10分钟，是否执行？&quot;)</span>
<span class="w">      </span><span class="na">v</span>
<span class="k">[ 用户确认 (Yes/No/Modify) ]</span>
<span class="w">      </span><span class="na">|</span>
<span class="w">      </span><span class="na">v</span>
<span class="k">[ 5. 智驾执行层 (AD Interface) ]</span>
<span class="w">      </span><span class="na">| (Input</span><span class="o">:</span><span class="w"> </span><span class="s">Waypoints, Trace, Mode=NOA)</span>
<span class="w">      </span><span class="na">v</span>
<span class="k">[ 车辆运动 (Motion Control) ]</span>
</code></pre></div>

<h3 id="52-the-brain">5.2 对话理解与上下文策略 (The Brain)</h3>
<p>LLM 不是简单的关键词匹配，而是基于<strong>话状态机（Dialogue State Tracking, DST）</strong>的动态管理。</p>
<h4 id="521-intent-slots">5.2.1 核心意图与槽位 (Intent &amp; Slots)</h4>
<p>除了基础的 <code>Navigation</code> 意图，必须支持复杂的修饰意图：</p>
<ul>
<li><strong>Primary Intent</strong>: <code>Start_Navigation</code><ul>
<li><code>Destination</code>: (POI / 坐标 / 模糊描述)</li>
<li><code>Waypoints</code>: (List of POIs)</li>
</ul>
</li>
<li><strong>Modifier Intent</strong>: <code>Update_Route</code><ul>
<li><code>Constraint</code>: "少走高速" (<code>highway: minimize</code>), "风景好" (<code>scenic: true</code>)</li>
<li><code>Action</code>: "添加途经点", "更换目的地", "取消导航"</li>
</ul>
</li>
<li><strong>Inquiry Intent</strong>: <code>Query_Status</code><ul>
<li><code>Target</code>: "还有多久" (ETA), "前面堵不堵" (Traffic)</li>
</ul>
</li>
</ul>
<h4 id="522">5.2.2 上下文记忆分级</h4>
<p>为了实现“像人一样交流”，Trip Agent 必须维护三层记忆：</p>
<ol>
<li><strong>Session Context (会话级)</strong>:<ul>
<li><em>生命周期</em>: 单次驾驶行程（上车~下车）。</li>
<li><em>内容</em>: 刚才提到的地点（“去那里”）、刚才否决的提议（“不要那条路”）。</li>
<li><em>案例</em>: 用户：“查下天气。” -&gt; Agent：“北京今天雨。” -&gt; 用户：“那不去了，改去天津。” (系统需理解“不去了”指代的是原本隐含的去北京的意图，或者取消之前的计划)。</li>
</ul>
</li>
<li><strong>Trip Context (行程级)</strong>:<ul>
<li><em>生命周期</em>: 导航任务开始~结束。</li>
<li><em>内容</em>: 当前剩余里程、下一个途经点状态、已行驶时间。</li>
<li><em>作用</em>: 支持中途修改——“前面找个厕所”（基于当前 Trip Context 在沿途搜索，而非全城搜索）。</li>
</ul>
</li>
<li><strong>User Profile (画像级)</strong>:<ul>
<li><em>生命周期</em>: 永久。</li>
<li><em>内容</em>: “家/公司”地址、偏好（晕车模式、讨厌隧道）、常去地点。</li>
</ul>
</li>
</ol>
<h3 id="53-grounding">5.3 地点解析：从模糊到精确 (Grounding)</h3>
<p>大模型输出的“去吃火锅”是无法导航的，需要经过 <strong>Grounding (落地)</strong> 过程。</p>
<ul>
<li><strong>Step 1: 实体提取 (NER)</strong>: 提取 "海底捞"。</li>
<li><strong>Step 2: 候选检索 (Retrieval)</strong>: 调用地图 API 获取当前定位周边的所有“海底捞”。</li>
<li><strong>Step 3: 排序与枝 (Ranking)</strong>:<ul>
<li>规则 A: 距离最近。</li>
<li>规则 B: 用户历史去过（从 Profile 获取）。</li>
<li>规则 C: 评分最高。</li>
</ul>
</li>
<li><strong>Step 4: 消歧策略 (Disambiguation)</strong>:<ul>
<li><em>Case 1 (置信度 &gt; 90%)</em>: 命中唯一常去店 -&gt; <strong>直接规划</strong>。</li>
<li><em>Case 2 (置信度 &lt; 60%)</em>: 有多家分店 -&gt; <strong>主动反问</strong> (“是去高新店还是万象城店？”)。</li>
</ul>
</li>
</ul>
<h3 id="54">5.4 路线偏好与约束</h3>
<p>LLM 需将自然语言转化为地图引擎的 <code>RoutePreference</code> 参数：</p>
<ul>
<li>“赶时间” -&gt; <code>Strategy: Fastest</code></li>
<li>“省点钱” -&gt; <code>Strategy: Avoid_Toll</code></li>
<li>“不想自己开” -&gt; <code>Strategy: AD_Friendly</code> (优先规划高精地图覆盖区域/高速公路)。</li>
</ul>
<h3 id="55-confirmation-mechanism">5.5 确认机制设计 (Confirmation Mechanism) —— 本章重点</h3>
<p><strong>Rule of Thumb</strong>: 任何改变车辆物理运动状态（Destination, Waypoint）的操作，必须有显式或隐式的确认；仅涉及信息查询（ETA, Weather）的操作可直接响应。</p>
<h4 id="551">5.5.1 确认交互矩阵</h4>
<p>| 场景 | 风险 | 交互模式 | UI 表现 | 超时策略 |</p>
<table>
<thead>
<tr>
<th style="text-align: left;">场景</th>
<th style="text-align: left;">风险</th>
<th style="text-align: left;">交互模式</th>
<th style="text-align: left;">UI 表现</th>
<th style="text-align: left;">超时策略</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>全新导航</strong></td>
<td style="text-align: left;">高</td>
<td style="text-align: left;"><strong>显式确认 (Explicit)</strong></td>
<td style="text-align: left;">倒计时卡片 + "出发"按钮</td>
<td style="text-align: left;">倒计时结束自动出发 (Hands-free)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>修改目的地</strong></td>
<td style="text-align: left;">极高</td>
<td style="text-align: left;"><strong>强确认 (Strong)</strong></td>
<td style="text-align: left;">弹窗阻断 + 必须语音/点击确认</td>
<td style="text-align: left;">超时取消 (Fail-safe)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>添加途经点</strong></td>
<td style="text-align: left;">中</td>
<td style="text-align: left;"><strong>隐式确认 (Implicit)</strong></td>
<td style="text-align: left;">Toast 提示 "已为您添加XX为途经点"</td>
<td style="text-align: left;">播报后自动生效</td>
</tr>
<tr>
<td style="text-align: left;"><strong>切换路线 (避堵)</strong></td>
<td style="text-align: left;">中</td>
<td style="text-align: left;"><strong>建议式确认 (Proactive)</strong></td>
<td style="text-align: left;">侧边栏卡片 "发现更快路线，省时5分"</td>
<td style="text-align: left;">需用户主动接受，否则维持原路</td>
</tr>
</tbody>
</table>
<h4 id="552-the-confirmation-card">5.5.2 屏幕确认卡片 (The Confirmation Card)</h4>
<p>设计要求：<strong>所见即所得 (WYSIWYG)</strong>。
卡片必须包含：</p>
<ol>
<li><strong>Mini Map</strong>: 预览全览图，高亮新旧路线差异。</li>
<li><strong>Key Metrics</strong>: 剩余时间、距离、费用。</li>
<li><strong>Action Buttons</strong>: [立刻出发] (主操作) / [取消] / [路线全览]。</li>
<li><strong>Voice Interaction</strong>: 支持语音指令 "确"、"选第一条"、"取消"。</li>
</ol>
<h3 id="56-ad">5.6 与自动驾驶 (AD) 的接口边界</h3>
<p>座舱与智驾通过标准 API 交互，严禁直接通过内存共享状态。</p>
<ul>
<li><strong>API: <code>SetNavigationRoute</code></strong><ul>
<li>输入: <code>List&lt;Waypoint&gt;</code> (经纬度), <code>RouteTrace</code> (加密的道路拓扑点串, 用于 E2E 匹配)</li>
<li>行为: AD 系统接收路径，进行可达性检查。</li>
</ul>
</li>
<li><strong>API: <code>GetADStatus</code></strong><ul>
<li>输出: <code>AD_Mode</code> (Manual/ACC/LCC/NOA), <code>Handover_Level</code> (接管等级)</li>
<li>作用: 座舱根据 AD 状态决定是否允许某些交互（如 AD 处于接管警报时，禁用复杂的语音点餐）。</li>
</ul>
</li>
<li><strong>API: <code>CancelNavigation</code></strong><ul>
<li>行为: AD 降级为 LCC (车道居中) 或 ACC，不再进行变道和转向。</li>
</ul>
</li>
</ul>
<h3 id="57-fail-safes">5.7 异常处理与兜底 (Fail-safes)</h3>
<ol>
<li><strong>地图数据不一致</strong>: 云端地图（座舱用）更新了道路，车端高精地图（智驾用）未更新。<ul>
<li><em>策略</em>: 智驾在 <code>SetNavigationRoute</code> 阶段返回 <code>MapMismatchError</code>。座舱提示用户：“该路段暂支持自动驾驶，将为您开启辅助巡航。”</li>
</ul>
</li>
<li><strong>网络断连</strong>:<ul>
<li><em>策略</em>: 切换至 <strong>On-board Small Model (端侧小模型)</strong> 或 <strong>规则引擎</strong>。仅支持“回家”、“去公司”等本地缓存的高频指令。</li>
</ul>
</li>
<li><strong>用户反悔</strong>:<ul>
<li><em>策略</em>: 屏幕常驻“撤销”按钮（保留 10 秒）。语音支持“取消刚才的操作”。</li>
</ul>
</li>
</ol>
<hr />
<h2 id="3">3. 本章小结</h2>
<ol>
<li><strong>从指令到对话</strong>: 导航不再是单向命令，而是基于 Agent 的双向协商过程。</li>
<li><strong>状态管理是核心</strong>: 必须维护清晰的 Session 和 Trip Context，才能处理“指代”和“修改”。</li>
<li><strong>确认即安全</strong>: 必须根据操作风险等级设计差异化的确认机制（Explicit vs. Implicit），防止 LLM 幻觉导致车辆误动作。</li>
<li><strong>端到端闭环</strong>: 这里的端到端不仅仅是算法模型的 E2E，而是从“用户嘴边”到“车轮转动”的产品体验闭环。</li>
</ol>
<hr />
<h2 id="4">4. 练习题</h2>
<h3 id="50">基础题 (50%)</h3>
<p><strong>Q1. 状态机流转</strong>
请画出状态，描述用户从“空闲”状态开始，通过语音发起导航，经历“多地点消歧”，最后“确认出发”并进入“导航中”状态的过程。</p>
<details>
<summary><b>参考答案</b> (点击展开)</summary>
<div class="codehilite"><pre><span></span><code><span class="o">[</span><span class="n">IDLE</span><span class="o">]</span><span class="w"> </span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="k">User</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;Nav to Wanda&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="n">v</span>
<span class="o">[</span><span class="n">INTENT_RECOGNIZED</span><span class="o">]</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="nl">Retrieval</span><span class="p">:</span><span class="w"> </span><span class="k">Found</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">Wandas</span><span class="p">)</span>
<span class="w">  </span><span class="n">v</span>
<span class="o">[</span><span class="n">AMBIGUITY_CHECK</span><span class="o">]</span><span class="w"> </span><span class="o">--</span><span class="p">(</span><span class="k">User</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;The one in CBD&quot;</span><span class="p">)</span><span class="o">--&gt;</span><span class="w"> </span><span class="o">[</span><span class="n">SLOT_FILLED</span><span class="o">]</span>
<span class="w">  </span><span class="o">^</span><span class="w">                                                </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="n">________</span><span class="p">(</span><span class="k">System</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;Which one?&quot;</span><span class="p">)</span><span class="n">__________________</span><span class="o">|</span>
<span class="w">                                                   </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">Route</span><span class="w"> </span><span class="n">Planning</span><span class="p">)</span>
<span class="w">                                                   </span><span class="n">v</span>
<span class="w">                                             </span><span class="o">[</span><span class="n">WAIT_CONFIRMATION</span><span class="o">]</span>
<span class="w">                                                   </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">Auto</span><span class="o">-</span><span class="n">countdown</span><span class="w"> </span><span class="ow">OR</span><span class="w"> </span><span class="k">User</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;Go&quot;</span><span class="p">)</span>
<span class="w">                                                   </span><span class="n">v</span>
<span class="w">                                             </span><span class="o">[</span><span class="n">NAVIGATING</span><span class="o">]</span>
</code></pre></div>

</details>
<p><strong>Q2. 接口字段设计</strong>
为了让 LLM 能够判断是否需要询问用户“走高速还是走下道”，地服务 (Map Service) 的 <code>RouteCalculation</code> 接口返回结果中应该包含哪些关键信息？</p>
<details>
<summary><b>参考答案</b> (点击展开)</summary>
<p>接口应返回 <strong>Route Candidates List</strong>，每条候选路线需包含：</p>
<ol>
<li><code>Route_Label</code>: 标签 (e.g., "最快", "免费", "路程短")</li>
<li><code>Duration</code>: 预计耗时</li>
<li><code>Toll_Cost</code>: 过路费</li>
<li><code>Traffic_Condition</code>: 拥堵指数</li>
<li><strong>Diff_Summary</strong>: 与最优路线的差异摘要 (e.g., "慢10分钟，省20元") —— <em>LLM 据此决定是否发起询问。</em></li>
</ol>
</details>
<p><strong>Q3. 兜底策略</strong>
当车机处于断网状态，且用户说了一句复杂的“去三里屯接个朋友然后去机场”，系统应如何反应？</p>
<details>
<summary><b>参考答案</b> (点击展开)</summary>
<ol>
<li><strong>检测网络状态</strong>: 确认 Offline。</li>
<li><strong>能力降级</strong>: 判定无法使用云端 LLM 解析复杂多跳意图。</li>
<li><strong>用户反馈</strong>: "网络不佳，暂时无法处理复杂路线。"</li>
<li><strong>引导简化</strong>: "请分步指令，先说第一个目的地" 或者尝试匹配本地离线语音库中的精确地点（如直接匹配“机场”）。</li>
</ol>
</details>
<hr />
<h3 id="50_1">挑战题 (50%)</h3>
<p><strong>Q4. 场景思考：隐私与便捷的冲突</strong>
用户 A 设置了“回家”地址。用户 B（访客）借用车辆。
B 说“回家”。系统应该直接导航去 A 的家，还是如何处理？请设计一套 User Profile 鉴权逻辑。</p>
<details>
<summary><b>参考提示</b> (点击展开)</summary>
<p>需引入 <strong>Voiceprint ID (声纹ID)</strong> 或 <strong>Face ID</strong> 结合 <strong>Role-Based Access Control (RBAC)</strong>:</p>
<ol>
<li><strong>识别用户</strong>: 识别出说话人是 B (Guest)。</li>
<li><strong>查询 Profile</strong>: B 没有设置“家”。</li>
<li><strong>策略分支</strong>:
   - 方案一 (保守): 提示“未找到您的家庭地址设置，请先在 App 中设置或直接说出地址。”
   - 方案二 (询问): “您是指去车主 A 的家吗？” (需 A 授权允许访客访问隐私地址)。</li>
<li><strong>推荐</strong>: 默认隔离。访客不能直接通过泛化指令访问车主的隐私地点，除非车主开启了“访客共享模式”。</li>
</ol>
</details>
<p><strong>Q5. 架构设计：多模态确认</strong>
在嘈杂环境下（车内音乐 + 孩子哭闹），ASR 识别率下降。此时用户试图通过语音确认修改路线，但系统反复听不清。
请设计一套 <strong>Multimodal Fallback (多模态回退)</strong> 机制来解决此问题，确保任务能闭环。</p>
<details>
<summary><b>参考提示</b> (点击展开)</summary>
<ol>
<li><strong>Confidence Monitoring</strong>: 监测 ASR 置信度或用户重复输入的次数 (Retries &gt; 2)。</li>
<li><strong>Mode Switch</strong>: 当语音交互受阻，主动降低语音权重，提升视觉/触控权重。</li>
<li><strong>UI Adaptation</strong>:
   - 屏幕弹出大尺寸确认卡片。
   - 语音播报：“环境太吵了，请直接点击屏幕上的‘出发’，或按方向盘上的 OK 键。”</li>
<li><strong>Physical Controls</strong>: 启用方向盘实体按键或中控旋钮作为 Confirm/Cancel 的输入源。</li>
</ol>
</details>
<p><strong>Q6. 极端场景：自动驾驶接管 (Takeover) 期间的语音交互</strong>
车辆正在 NOA 状态下导航突然遇到复杂路况请求人工接管（Takeover Request）。
此时 LLM 正在播报一段很长的“目的地天气介绍”。
作为 PM，你如何定义此时的 <strong>Audio Focus (音频焦点)</strong> 和 <strong>Dialogue State</strong>？</p>
<details>
<summary><b>参考提示</b> (点击展开)</summary>
<p>这是一条 <strong>Safety-Critical</strong> 规则：</p>
<ol>
<li><strong>Priority Interrupt</strong>: AD 的报警音 (Chimes) 优先级最高 (P0)。</li>
<li><strong>Action</strong>: 
   - 立即 <strong>Terminate (终止)</strong> TTS 播报。
   - 暂停 LLM 的思考或生成。
   - 屏幕强制切换到 AD 接管提示界面（压盖住导航/聊天界面）。</li>
<li><strong>Post-Takeover</strong>: 接管完成且恢复平稳后，系统<strong>不应</strong>自动恢复播放天气（以免分散驾驶员注意力），而是保持静默，或以 Toast 形式由于通知栏显示“刚才的天气播报已中断”。</li>
</ol>
</details>
<hr />
<h2 id="5-gotchas">5. 常见陷阱与错误 (Gotchas)</h2>
<h3 id="1-the-yes-trap">1. "是的" 陷阱 (The "Yes" Trap)</h3>
<ul>
<li><strong>错误</strong>: 用户在聊天时说“是的，我觉得也是”，被系统误为确认了后台挂起的“是否切换路线”的询问。</li>
<li><strong>对策</strong>: 确认必须具备 <strong>Context Check (上下文校验)</strong>。确认指令必须紧跟在询问之后（Time Window &lt; 5s），且最好要求 Slot Filling（如“确认切换”优于“是的”）。</li>
</ul>
<h3 id="2-eta">2. 忽略 ETA 的动态变化</h3>
<ul>
<li><strong>错误</strong>: LLM 规划时告诉用户“预计 20 分钟到达”，但由于用户思考和确认花了 5 分钟，实际路况变了。</li>
<li><strong>对策</strong>: 在用户最终点击/说出“出发”的那一刻，必须 <strong>Re-calculate (重算)</strong> 一次 ETA，如果差异过大（&gt;5分钟），需再次提示用户。</li>
</ul>
<h3 id="3_1">3. 过度拟人化的代价</h3>
<ul>
<li><strong>错误</strong>: Agent 废话太多——“好的，主人，我正在非常努力地为您寻找去星巴克的路线，请您稍等片刻...”。</li>
<li><strong>对策</strong>: 导航场景追求 <strong>Efficiency (效率)</strong>。遵循 <strong>Grice's Maxims (格赖斯准则)</strong>：数量准则（信息量适中）、质量准则（不瞎说）。直接回：“好的，去星巴，已为您找到最近的一家。”</li>
</ul>
<h3 id="4_1">4. 途经点顺序混乱</h3>
<ul>
<li><strong>错误</strong>: 用户说“去 A，顺便去 B 接人”。LLM 按距离排序把 A 排前面，但用户意图是先接人(B)再去 A。</li>
<li><strong>对策</strong>: 引入 <strong>Logic Reasoning (逻辑推理)</strong>。识别“顺便”、“先去”、“然后”等时序连接词。如果无法确定，必须反问：“是先去 B 吗？”</li>
</ul>
            </article>
            
            <nav class="page-nav"><a href="chapter4.html" class="nav-link prev">← Chapter 4｜驾舱一体目标架构总览</a><a href="chapter6.html" class="nav-link next">Chapter 6｜座舱大模型升级方案（多域融合且稳定可控） →</a></nav>
        </main>
    </div>
</body>
</html>
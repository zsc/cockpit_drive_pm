# Chapter 16｜附录：模板、清单与术语 (Toolkit & Standards)

## 1. 开篇段落

在“驾舱一体”项目中，最大的挑战往往不是技术本身，而是跨团队（自动驾驶算法、座舱应用、云端大模型、车辆工程）的**语义对齐**与**交付标准统一**。当产品经理描述“智能导航”时，算法工程师可能理解为路径规划，而交互设计师理解为语音动效。

本章汇编了经过验证的标准化工具，包括**术语表（Glossary）**、**PRD 标准模板**、**技术方案架构模板**、**工具调用契约（Schema）**、**里程碑验收清单（Gate Checklists）** 以及 **RACI 权责矩阵**。

**本章目标**：
1.  **消除歧义**：通过统一定义，确保所有人在同一个频道对话。
2.  **强制规范**：通过模板中的必填项，强制思考“降级策略”、“确认机制”与“安全边界”。
3.  **落地执行**：提供可直接复制粘贴的 JSON Schema 和 Excel 表头，减少从理论到落地的摩擦。

---

## 2. 文字论述与标准模板

### 16.1 术语表与缩写 (The "Driving-Cabin" Glossary)

为了弥合自动驾驶（硬实时/强安全）与大模型（概率性/强交互）的鸿沟，必须严格定义以下术语。

#### 2.1.1 核心业务术语
| 术语/缩写 | 全称 | 定义与业务含义 |
| :--- | :--- | :--- |
| **Trip Agent** | Trip Agent | **行程代理**。本项目核心逻辑单元，负责维护“从出发到到达”全周期的状态，协调导航、电量、偏好与POI推荐。 |
| **Contextual Nav** | Contextual Navigation | **上下文导航**。区别于传统指令式导航，指具备记忆（“去上次那家”）、理解隐喻（“找个方便停车的吃饭地”）能力的导航体验。 |
| **Confirmation** | Explicit Confirmation | **显式确认**。系统在执行高风险或高成本动作前，强制要求用户进行二次确认（语音“是/否”或点击屏幕）的机制。 |
| **Clarification** | Ambiguity Clarification | **歧义澄清**。当用户意图模糊（如“去万达”但同城有3个）时，系统主动反问的过程。 |
| **One-Shot** | One-Shot Command | **一语直达**。无需唤醒词，或将唤醒词与指令连读（“HiX去公司”）的交互方式。 |
| **HMI Handover** | Human-Machine Handover | **人机共驾接管**。自动驾驶与人工驾驶权限切换的时刻，驾舱一体需在此刻提供关键提示（视觉+语音+触觉）。 |

#### 2.1.2 技术与架构术语
| 术语/缩写 | 全称 | 定义与业务含义 |
| :--- | :--- | :--- |
| **Tool Calling** | Tool/Function Calling | **工具调用**。LLM 输出特定 JSON 结构以触发外部 API（如控车、调地图）的能力。 |
| **Slot Filling** | Slot Filling | **槽位填充**。从非结构化语言中提取结构化参数（如 `Dest=天安门`, `Time=明天`）的过程。 |
| **Guardrails** | Safety Guardrails | **安全护栏**。独立于 LLM 之外的确定性代码层（规则引擎），用于拦截不安全指令（如“倒车时开尾门”）。 |
| **RAG** | Retrieval-Augmented Generation | **检索增强生成**。将车辆手册、实时路况或用户历史作为上下文注入 Prompt 的技术。 |
| **Shadow Mode** | Shadow Mode | **影子模式**。新模型在后台运行但不控车，仅记录其决策与实际驾驶员行为的差异，用于评测。 |
| **TTFT** | Time To First Token | **首字时延**。用户说完话到屏幕显示第一个文字或听到第一个音节的时间。 |
| **SSOT** | Single Source of Truth | **单一事实来源**。指车辆状态（如车速、位置）必须有唯一的读取接，避免座舱和智驾读取的数据不一致。 |

---

### 16.2 驾舱一体 PRD 模板 (Enhanced PRD Template)

> **Rule of Thumb**: 每一个 AI 功能需求，都必须包含“Prompt 约束”、“确认策略”和“失败兜底”三要素，否则不予评审。

#### [文档头部]
*   **Feature Name**: 基于上下文的智能改航
*   **PRD ID**: PRD-NAV-2025-001
*   **Complexity**: High (涉及 LLM + Map + AD)
*   **Target Version**: OTA v2.1

#### 1. 业务目标与价值 (Business Goal)
*   **User Value**: 解决驾驶途中无法通过模糊指令（“想喝咖啡”）顺路修改行程的痛点。
*   **Success Metrics**:
    *   改航任务达成率 > 90%
    *   对话交互轮次 Avg < 2.5 轮
    *   误导航率（导航到错误地点） < 1%

#### 2. 核心交互流程 (Interaction Flow)
*(此处应插入泳道图：User -> ASR -> LLM Agent -> Policy Engine -> Map Service -> TTS/Screen)*

#### 3. 详细功能需求 (Functional Requirements)

| ID | 功能点 | 用户故事 (User Story) | 输入上下文 (Context Inputs) | 系统逻辑 (System Logic) | 确认策略 (Confirmation) | 输出/反馈 (Output) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| F1 | **模糊地点搜索** | "途中想找个**评分高**且**好停车**的火锅店" | 1. 当前位置<br>2. 剩余路线<br>3. 大众点评API<br>4. 停车场数据 | 1. 沿途搜(Route Search)<br>2. 过滤: 评分>4.5 & 停车标签=True<br>3. 排序: 综合推荐 | **必须确认** (因为偏离原路线) | 语音: "沿途找到两家，推荐X店，评分4.8且有专属车位，去这里吗？"<br>屏幕: 显示卡片列表 |
| F2 | **代词指代** | "就去**那家**" | 1. 上一轮对话结果列表 | 1. 解析"那家"=列表第一项/高亮项 | 无需确认 (紧接上文) | 直接发起导航请求 |
| F3 | **驾驶模式联动** | "我有点累了" | 1. 当前 AD 状态<br>2. 车辆配置 | 1. 判断是否具备智驾功能<br>2. 意图=开启辅助驾驶 or 寻找服务区 | **强确认** (涉及控车) | 音: "已为您打开座椅按摩。建议开启辅助驾驶或导航至最近服务区休息，需要吗？" |

#### 4. 非功能需求 (Non-Functional Req)
*   **Latency**: 端到端响应 < 1.5s (Wifi/5G), < 3s (4G)。
*   **Availability**: 弱网下自动降级为离线指令模式（不支持模糊搜索，仅支持明确指令）。
*   **Concurrency**: 支持主驾与副驾同时发出指令（副驾权限受限，详见权限表）。

#### 5. 安全与合规 (Safety & Compliance)
*   **Data Privacy**: 搜索记录仅在本地存储，云端处理需脱敏。
*   **Content Safety**: 屏蔽黄赌毒相关地点的搜索与导航。
*   **AD Safety**: 在 AD 紧急接管（MRM）状态下，**强制静默**座舱语音，优先播放 AD 警报。

#### 6. 埋点需求 (Tracking)
*   `event: intent_recognized`: {intent: "search_food", confidence: 0.95}
*   `event: tool_execution`: {tool: "map_api", status: "success", latency: 400ms}
*   `event: user_confirmation`: {type: "voice", value: "positive"}

---

### 16.3 工具调用定义表 (Tool Calling Schema & Registry)

这是连接大模型与物理世界的**法律契约**。定义不清会导致“大模型乱按按钮”。

**Schema 定义规范 (JSON format)**

```json
{
  "name": "set_navigation_destination",
  "description": "设置车辆导航的目的地。仅在用户明确表达出行意图时调用。",
  "parameters": {
    "type": "object",
    "properties": {
      "poi_name": {
        "type": "string",
        "description": "地点的具体名称，如'北京朝阳大悦城'。"
      },
      "poi_type": {
        "type": "string",
        "enum": ["gas_station", "charging_station", "restaurant", "parking", "general"],
        "description": "地点类别，用于地图引擎优化搜索权重。"
      },
      "strategy": {
        "type": "string",
        "enum": ["fastest", "avoid_highway", "economic"],
        "description": "路线偏好策略。"
      }
    },
    "required": ["poi_name"]
  },
  "risk_level": "high",
  "mutex_conditions": ["vehicle_status.is_reversing", "system.is_updating"]
}
```

**工具注册表 (Tool Registry Table)**

| 工具 ID | 功能名称 | 关键参数 | 风险等级 | 权限要求 | 互斥/前置条件 | 失败话术模板 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| `nav_set_dest` | 设目的地 | POI, 策略 | **High** | 驾驶员/副驾 | 倒车时禁用 | "正在倒车，请稍后设置导航。" |
| `veh_win_ctrl` | 车窗控制 | 目标窗, 开度 | Medium | 全员 | 儿童锁开启时禁用 | "后排儿童锁已开启，无法操作车窗。" |
| `media_play` | 媒体播放 | 歌名, 歌手 | Low | 全员 | 电话会议中禁用 | "通话中无法播放音乐。" |
| `ad_mode_on` | 开启智驾 | 模式ID | **Critical** | **仅驾驶员** | 车速>30, 车道线清晰 | "当前路况不满足辅助驾驶开启条件。" |

---

### 16.4 验收里程碑清单 (Gate Checklists)

项目经理（TPM）使用此表控制项目生命周期。

#### Gate B: 架构与设计冻结 (Design Freeze)
*入场条件：PRD 评审通过，UX 稿定稿。*

| 检查项 | 验收标准 | 必须证据 (Deliverables) | 负责人 |
| :--- | :--- | :--- | :--- |
| **接口契约** | 车云、驾舱接口文档（API/Proto）已发布并锁定。 | Swagger/Proto 文件链接 | 架构师 |
| **安全策略** | 完成威胁建模（STRIDE），定义好所有 Policy Engine 拦截规则。 | 安全评审报告 | 安全官 |
| **模型选型** | 确定基座模型版本，完成 Prompt 初始版本设计。 | 模型评估报告 (Benchmark) | 算法TL |
| **测试方案** | 定义好测试集来源（仿真/实车/录音），准备好测试数据。 | 综合测试计划书 | QA经理 |
| **隐私合规** | 法务审核通过数据采集与上传方案。 | 合规审批邮件 | PM |

#### Gate D: 集成测试通过 (Integration Complete)
*入场条件：各模块单元测试通过，代码合并。*

| 检查项 | 验收标准 | 必须证据 (Deliverables) | 负责人 |
| :--- | :--- | :--- | :--- |
| **功能闭** | 核心链路（Vision->Action）在实车环境跑通，无阻塞性 Bug。 | 实车演示视频 | 研发TL |
| **性能达标** | 端到端时延 < 1.5s (P90)，GPU/CPU 占用率符合预算。 | 性能测试报告 | QA |
| **稳定性** | 连续运行 48 小时无 Crash，无内存泄漏。 | 稳定性压测报告 | QA |
| **降级演练** | 拔网线、屏蔽 GPS 信号，系统能正确触发降级提示。 | 故障注入测试日志 | 架构师 |
| **确认机制** | 所有 High 风险操作均正确触发了二次确认。 | 用例执行记录 | PM |

#### Gate F: 量产发布 (SOP Ready)
*入场条件：Pilot 试点无重大事故，遗留 Bug 归零或 Waiver。*

| 检查项 | 验收标准 | 必须证据 (Deliverables) | 负责人 |
| :--- | :--- | :--- | :--- |
| **红队测试** | 完成对抗性攻击测试（Prompt Injection），无高危漏洞。 | 安全渗透测试报告 | 安全团队 |
| **路测验收** | 累积路测里程 > X万公里，接管率 < Y次/千公里。 | 路测统看板 | 测试总监 |
| **舆情/客服** | 客服话术培训完成，FAQ 已更新。 | 培训签到表 | 客服接口人 |
| **回滚预案** | 具备“一键熔断”开关（关闭 LLM 仅保留规则），并在生产环境验证过通路。 | 熔断演练记录 | 运维/SRE |

---

### 16.5 RACI 详细权责矩阵

明确“谁做（R）”、“谁拍板（A）”、“谁提供支持（C）”、“通知谁（I）”。

| 任务领域 | 细分任务 | PM (产品) | TPM (项目) | Dev-Cockpit (座舱) | Dev-AD (智驾) | Dev-Algo (模型) | QA (测试) | Safety (安全) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **需求阶段** | 场景定义与 PRD | **R/A** | C | C | C | C | C | I |
| | 确认机制与交互设计 | **R** | I | C | I | I | C | **A** (安全审核) |
| **开发阶段** | Tool Schema 定义 | C | I | **R** | C | **R** | I | A |
| | Prompt 编写与调优 | I | I | I | I | **R/A** | I | C |
| | 策略引擎(Guardrail)配置 | C | I | **R** | C | I | I | **A** |
| | 智驾状态接口(State API) | I | I | C | **R** | I | C | C |
| **测试阶段** | 仿真/回放测试 | I | I | I | C | C | **R/A** | I |
| | 实车路测 | I | C | I | I | I | **R** | C |
| | 红队攻击 (Red Teaming) | I | I | I | I | C | C | **R/A** |
| **发布运营** | 灰度放量策略 | **R** | **A** | C | C | C | I | I |
| | 线上事故熔断/回滚 | C | **A** | R | R | R | I | C |

---

### 16.6 场景用例标准模板 (Test Case Template)

用于 QA 编写用例和自动化脚本开发。

*   **Case ID**: TC-NAV-008
*   **Case Name**: 导航中途修改目的地（含费用确认）
*   **Priority**: P0
*   **Pre-condition**: 车辆在高速公路智驾模式（NOA）下，已设置目的地A。
*   **Test Data**: 模拟高德地图 API 返回“目的地B 有高速费 50元”。

| 步骤 | 角色 | 动作/输入 | 预期结果 (Expected Result) | 检查点 (Checkpoints) |
| :--- | :--- | :--- | :--- | :--- |
| 1 | User | 唤醒并说：“换个地方，去最近的机场。” | 系统识别意图 `nav_dest`，Slot=`机场`，Strategy=`nearest`。 | Log 中 Intent 是否正确？ |
| 2 | System | (后台处理) | 调用地图API搜索，计算发现需要切路且产生费用。判断需确认。 | `Needs_Confirm=True` |
| 3 | System | 语音+屏幕反馈 | TTS：“好的，去首都机场。这将改变当前路线并产生高速费，确认吗？”<br>屏幕显示路线对比卡片。 | **关键点**：AD 状态未改变，车辆保持原路线行驶。 |
| 4 | User | 说：“确认。” | 系统下发新路线给 AD 域。 | 确认后，AD 域接收新 Route。 |
| 5 | System | 执行 | AD 域规划变道，语音播报“正在前往...”。 | 观察车辆是否平滑变道。 |

---

## 3. 本章小结

本附录是项目执行的**“度量衡”**。
*   **术语表**防止了“鸡同鸭讲”。
*   **PRD 模板**强行植入了“AI 容错”基因。
*   **Tool Schema** 是大模型与车辆安全的防火墙。
*   **Gate 清单** 确保了我们不会病上线。
*   **RACI 矩阵** 杜绝了“三不管”地带。

**Rule of Thumb**: 如果你在开发中遇到文档未定义的模糊地带，**不要猜测**，请立即发起 CR（Change Request）更新本附录。文档的厚度代表了我们对安全的敬畏程度。

---

## 4. 练习题

<details>
<summary><strong>习题 1（基础）：Schema 设计</strong></summary>

**题目**：你需要为“座椅调节”功能设计一个 Tool Schema。考虑到安全，请问 `parameters` 中应该包含哪些字段？为什么不能只给一个 `description: "adjust seat"` 让 LLM 自己生成指令？

**提示**：考虑具体的座椅位置（主驾/副驾）、调节方向、以及 LLM 可能产生的幻觉。

> **参考答案**：
> 1.  **必须包含的字段**：
>     *   `seat_id`: Enum ["driver", "passenger", "rear_left", "rear_right"]（明确调节哪个椅子）。
>     *   `action`: Enum ["move_forward", "move_back", "recline", "heat_level"]（限制动作范围）。
>     *   `value`: Integer/Range（限制调节幅度，防止一下子调到底）。
> 2.  **原因**：如果让 LLM 自由生成，它可能生成 `{"action": "eject"}`（弹射，虽然车没这功能）或者 `{"seat": "roof"}` 等无效或危险指令。强类型的 Schema 配合 Enums 能在入口处拦截 99% 的非法参数，确保发给底层 ECU 的指令是合法的。
</details>

<details>
<summary><strong>习题 2（进阶）：Gate 决策</strong></summary>

**题目**：在 Gate F（量产发布）评审会上，发现一个 P2 级 Bug：在地下车库（无网）时，用户说“打开车窗”，响应时间长达 5 秒（因为系统在尝试联网超时后才切回离线规则）。
作为 TPM，你应该：
A. 延期发布，修复后再上线。
B. 忽略此问题，直接上线。
C. 签署 Waiver（豁免），带病上线但承诺 OTA 修复。
请选择并阐述理由。

**提示**：考虑 P2 的定义、场景频次以及用户体验的恶劣程度。

> **参考答案**：
> **推荐选择 A (延期) 或 极严格条件下的 C。**
> *   **分析**：地下车库是极高频场景，且“打开车窗”是极其基础的控车指令。5秒延迟给用户的感觉是“死机”或“失灵”，这会严重摧毁用户对“智能座舱”的信任感，甚至导致用户在慌乱中重复操作引发安全隐患。
> *   **决策**：这虽然标记为 P2，但对体验杀伤力等同于 P0。除非有极其紧迫的商业承诺且能通过 UI 提示缓解（如显示“正在尝试连接...”），否则应 Fix 后上线。如果是 5秒 缩短到 2秒，可以选 C；如果是 5秒，建议选 A。
</details>

<details>
<summary><strong>习题 3（场景）：RACI 应用</strong></summary>

**题目**：线上发生了一起客诉：用户在高速上对车机说“我想睡觉”，结果车机自动把座椅放平了（导致驾驶员无法看路），险些酿成事故。
请根据 RACI 矩阵分析：
1. 谁对“座椅放平”这个功能的**安全性**负责？
2. 谁对“别出睡觉意图”负责？
3. 这是一个 Feature 还是一个 Bug？

**提示**：区分意图识别（NLP）和策略控制（Policy）。

> **参考答案**：
> 1.  **安全性负责**：**Safety 团队 (A) 和 Dev-Cockpit (R)**。策略引擎应该配置一条规则：`IF speed > 0 THEN disable seat_recline_fully`。这是硬安全逻辑的缺失。
> 2.  **意图识别负责**：**Dev-Algo (R)**。LLM 正确识别了用户想睡觉，并调用了放平座椅工具，从 NLP 角度它工作“正常”。
> 3.  **定性**：这是一个 **Critical Safety Bug（设计缺陷）**。系统正确执行了指令，但执行了错误的（不安全的）决策。根本原因在于**策略引擎（Guardrails）**未能拦截高速行驶下的危险动作。
</details>

<details>
<summary><strong>习题 4（实战）：PRD 撰写</strong></summary>

**题目**：在撰写“语音调整巡航车速”的 PRD 时，你需要定义“确认策略”。
情景 1：用户说“车速调高一点”。
情景 2：用户说“车速设为 120”。当前限速 80。
请分别给出确认策略。

**提示**：区分“微调”和“绝对值设定”，以及“合法性校验”。

> **参考答案**：
> *   **情景 1 (微调)**：**弱确认或无确认**。
>     *   策略：直接执行（通常 +5km/h），伴随语音反馈“已调速至 XX”。因为风险可控，用户可随时踩刹车接管。
> *   **情景 2 (越界/高风险)**：**拒绝执行或强确认**。
>     *   策略：系统检测到 120 > 当前道路限速 80。
>     *   反馈：**拒绝**。TTS：“当前道路限速 80，无法设定为 120。”
>     *   *（注：如果是在不限速路段大幅提速，如从 60 提至 120，则需要**强确认**：“即将加速至 120，请确认。”）*
</details>

---

## 5. 常见陷阱与错误 (Gotchas)

1.  **“Prompt 依赖症”**：
    *   *错误*：试图用 Prompt（提示词）来解决所有安全问题（如“请不要在高速时打开后备箱”）。
    *   *真相*：LLM 永远有概率失效。**必须**使用确定性的代码（If-Else 策略引擎）来做最后一道防线。Prompt 只是软约束，代码才是硬约束。

2.  **Schema 定义过松**：
    *   *错误*：参数定义为 `String` 类型且无枚举限制。
    *   *后果*：用户说“打开左边那个窗”，LLM 传参 `{"window": "left_one"}`，但代码只认识 `FL` 或 `RL`，导致执行失败。
    *   *修正*：在 Schema 中使用 `Enum` 严格枚举所有可能值，强迫 LLM 做映射。

3.  **忽略 TTS 的延迟**：
    *   *错误*：测试时只看 log 觉得处理很快，但真车上 TTS 播报太慢（“好的，正在为您查找...由于网络原因...”），导致用户在播报结束前已经不耐烦地发起了第二次指令，造成指令堆叠。
    *   *修正*：设计简短、干练的 TTS，支持**打断（Barge-in）**，并在检测到新指令时立即停止上一条播报。

4.  **把“不知道”当“错误”**：
    *   *误*：强迫模型必须回答所有问题。
    *   *真相*：对于 LLM 不确定的意图，**拒答**或**澄清**（“您是想去南京路还是南京西路？”）远比**瞎猜**（直接导航去南京路）要好。在 PRD 中要明确定义“低置信度”时的澄清行为。

5.  **缺乏“撤销”入口**：
    *   *错误*：语音改了目的地后，屏幕上没有显眼的“恢复原路线”按钮。
    *   *真相*：语音交互是瞬时的，用户很容易反悔。每次由语音触发的关键状态变更，屏幕上都应保留 5-10 秒的 **Undo（撤销）** 浮窗。
